---
title: "javaScriptéåŒæœŸå‡¦ç†ã¾ã¨ã‚"
emoji: "ğŸ¦"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [javaScript]
published: true
---

# javaScript éåŒæœŸå‡¦ç†ã¾ã¨ã‚

javaScript ã®éåŒæœŸå‡¦ç†ã¯ã€callback, promise, await-async ã‚’ä½¿ç”¨ã—ãŸ
ä¸‰ç¨®é¡ã®æ–¹æ³•ãŒã‚ã‚‹ã€‚ãã‚Œãã‚Œç¢ºèªã—ã¦ã„ã“ã†ã€‚

## callback

callback é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§éåŒæœŸå‡¦ç†ã‚’å®Ÿç¾ã§ãã¾ã™
ã—ã‹ã—ã€ãƒ¢ãƒ€ãƒ³ javaScript ã§ã¯ã‚ã¾ã‚Šä½¿ã‚ãªã„ã®ã§ã•ã‚‰ã£ã¨æµã—ã¾ã™

ã§ã¯è©¦ã—ã« setTimeout ã§ 1 ç§’å¾Œã«å‡¦ç†ã‚’è¡Œã† wait é–¢æ•°ã‚’å®šç¾©ã—ã¾ã—ã‚‡ã†
num ã‚’è¡¨ç¤ºã—ãŸå¾Œã« callback é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹é–¢æ•°ã«ãªã£ã¦ã„ã¾ã™

```javaScript: index.js
const wait = (callback, num) => {
  setTimeout(() => {
    console.log(num);
    callback(num);
  }, 1000);
};
  //å®Ÿè¡Œ
wait((num) => {
  console.log("test");
}, 0);
```

å®Ÿè¡Œçµæœã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚0 ãŒè¡¨ç¤ºã•ã‚ŒãŸå¾Œã« test ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã­ã€‚
![](https://storage.googleapis.com/zenn-user-upload/961855f222ba-20220908.png)

ã“ã“ã‹ã‚‰ã€wait ã®å®Ÿè¡ŒãŒçµ‚ã‚ã£ãŸã‚‰é•ã†å‡¦ç†ã‚’ã—ãŸã„å ´åˆã‚’è€ƒãˆã¾ã—ã‚‡ã†
ä»Šå›ã¯ wait ã‚’å…¥ã‚Œå­ã«ã™ã‚‹ã“ã¨ã§å®Ÿç¾ã—ã¾ã™

```javaScript: index.js
wait((num) => {
  num++;
  wait((num) => {
    num++;
    wait((num) => {
      num++;
      console.log("test");
    }, num);
  }, num);
}, 0);
```

å®Ÿè¡Œçµæœ
1 ç§’ã”ã¨ã«ï¼,ï¼‘,ï¼’,ã¨è¡¨ç¤ºã®å¾Œ test ã¨è¡¨ç¤ºã™ã‚‹
![](https://storage.googleapis.com/zenn-user-upload/c257439b261c-20220908.png)

ã“ã‚Œã§éåŒæœŸå‡¦ç†ãŒå®Ÿç¾ã§ãã¦ã‚‹ï¼ã‚„ã£ãŸãƒ¼ï¼

â€¦ã„ã‚„ã€å…¥ã‚Œå­æ§‹é€ ã¯è¦‹ã¥ã‚‰ã„ã‚ï¼ï¼ï¼

ã¨ã„ã†ã‚ã‘ã§ã“ã®ã‚ã‚“ã©ãã•ã•ã®è§£æ±ºã‚’ã—ã¾ã—ã‚‡ã†

## Promise

å…ˆã»ã©ã® wait ã‚’ Promise ã‚’ä½¿ã£ã¦æ›¸ãæ›ãˆã¾ã™

```javaScript: index.js
const wait = (num) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log(num);
      resolve(num);
    }, 1000);
  });
};
```

æœ€åˆè¦‹ãŸæ™‚ã€Œãªã‚“ã ã“ã‚Œã€ã¨æ€ã„ã¾ã—ãŸãŒã€ã‚ã¡ã‚ƒãã¡ã‚ƒã‚ˆãå‡ºæ¥ã¦ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã‚ˆã­ã€‚
ã“ã“ã§ return ã§ Promise ã‚¯ãƒ©ã‚¹ã‚’è¿”ã—ã¦ã„ã‚‹ã®ã¯ã‚ã‹ã‚‹ã¨æ€ã„ã¾ã™ã€‚
å•é¡Œã¯å¼•æ•°ã® resolve ã¨ reject ã§ã™ã€‚
ã¨ã‚Šã‚ãˆãš resolve ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

### resolve ã¨ã¯ï¼Ÿ

Promise ã¯ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ã§ã¤ãªã’ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã®ã§ã™ãŒã€
ãã®æˆ»ã‚Šå€¤ãŒ resolve ã§è¨­å®šã—ãŸå€¤ã«ãªã‚Šã¾ã™
ãã—ã¦ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ã§ã¤ãªã’ã‚‹æ–¹æ³•ã¯ã€then ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¤ãªã„ã§ã„ãã¾ã™

![](https://storage.googleapis.com/zenn-user-upload/90bf4ea7a9e4-20220908.png)

```javaScript: index.js
wait(0).then((num) => {
    num++;
    // returnã§Promiseã‚’è¿”ã™ã¨ãƒã‚§ãƒ¼ãƒ³ãŒç¶™ç¶šã—éåŒæœŸå‡¦ç†ãŒã§ãã‚‹
    return wait(num);
  })
```

ä¸Šè¨˜ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€wait(0)ã®å®Ÿè¡Œå¾Œã« then ãƒ¡ã‚½ãƒƒãƒ‰ä»¥é™ã®å‡¦ç†ã‚’è¡Œãˆã¾ã™
ã•ã‚‰ã«ã€return ã§ Promise ã‚’è¿”ã™ã“ã¨ã§ã€ã•ã‚‰ã«ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ã‚’ã¤ãªã’ã‚‹ã“ã¨ãŒã§ãã¾ã™
ï¼ˆã“ã®å ´åˆã€wait ã®æˆ»ã‚Šå€¤ã¯ Promise ã«ãªã£ã¦ã„ã‚‹ï¼‰

ã§ã¯ return ã§ Promise ã‚’æˆ»ã•ãªã‹ã£ãŸå ´åˆã¯ï¼Ÿ
ã‚‚ã¡ã‚ã‚“éåŒæœŸå‡¦ç†ãŒå´©ã‚Œã‚‹

```javaScript: index.js
wait(0).then((num) => {
    num++;
    return wait(num);
  })
  .then((num) => {
    num++;
    // æˆ»ã‚Šå€¤ã‚’Promiseã«ã—ãªã„
    wait(num);
    // ãƒã‚§ãƒ¼ãƒ³ãŒåˆ‡ã‚Œã¦éåŒæœŸå‡¦ç†ãŒå‡ºæ¥ãªããªã‚‹
    return num;
  })
  .then((num) => {
    num++;
    //2ã¨3ã¯åŒæ™‚ã«å‡ºåŠ›ã•ã‚Œã‚‹
    wait(num);
    return num;
  });
```

ï¼’ã¤ã‚ã® then ãƒ¡ã‚½ãƒƒãƒ‰ã®ä¸­ã§ã€return ã§ Promise ã‚’æˆ»ã•ãªã‹ã£ãŸãŸã‚ã€
2,3 ã¯åŒæ™‚ã«å‡ºåŠ›ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹

### reject ã¯ï¼Ÿ

reject ã¯ä½•ã«ä½¿ã†ã‹ã¨ã„ã†ã¨ã€ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸæ™‚ã®å‡¦ç†ã«ä½¿ç”¨ã—ã¾ã™

```javaScript: index.js
const wait = (num) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log(num);
      // numãŒ2ã«ãªã£ãŸã‚‰ã‚¨ãƒ©ãƒ¼ã¨ã™ã‚‹
      if (num === 2) {
        reject(num);
      } else {
        resolve(num);
      }
    }, 1000);
  });
};
```

ã‚¨ãƒ©ãƒ¼ã«ãªã£ãŸã‚‰å‡¦ç†ã¯ã©ã†ãªã‚‹ã®ã‹ï¼Ÿ

ä»–ã®è¨€èªã®å ´åˆã€ä¾‹ãˆã° Java ãªã‚‰ã‚¨ãƒ©ãƒ¼ã¯ try ã—ã¦ catch ã—ã¾ã™ã‚ˆã­ï¼Ÿ
ã“ã®å ´åˆã‚‚åŒã˜ã§ã€reject ã«å€¤ãŒæ¸¡ã£ãŸæ™‚ç‚¹ã§ then ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ãªã
catch ãƒ¡ã‚½ãƒƒãƒ‰ã«å‡¦ç†ãŒæ¸¡ã‚Šã¾ã™

```javaScript: index.js
wait(0)
  .then((num) => {
    num++;
    return wait(num);
  })
  .then((num) => {
    num++;
    return wait(num);
  })
ã€€.catch(num => {
    // rejectã«å€¤ãŒæ¸¡ã£ãŸã‚‰catchã«æ¸¡ã‚Šã€
    // å¼•æ•°ãŒrejectã«è¨­å®šã—ãŸå€¤ã«ãªã‚‹
    // ä»Šå›ã®å ´åˆã¯num
    num++;
    console.error(num, 'error');
  })
```

å®Ÿè¡Œçµæœ
![](https://storage.googleapis.com/zenn-user-upload/8569ed488bb4-20220908.png)

### ä¸¦åˆ—å‡¦ç†

Promise ã‚’ä½¿ã£ã¦ã€è¤‡æ•°ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä¸¦åˆ—ã«å‡¦ç†ã—ã€å…¨ã¦ãŒçµ‚ã‚ã£ãŸã‚‰æ¬¡ã®å·¥ç¨‹ã«é€²ã‚€ã¨ã„ã†ã“ã¨ãŒã§ãã¾ã™

ã¾ãšã¯ wait ã‚’å¼•æ•°ã«ä¸ãˆã‚‰ã‚ŒãŸç§’æ•°å¾…ã¤ã‚ˆã†ã«å¤‰æ›´

```javaScript: index.js
const wait = (num) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log(num);
      resolve(num);
    }, num);
  });
};
```

ãã—ã¦ä¸¦åˆ—å‡¦ç†ã¯ä»¥ä¸‹ã®ã‚ˆã†ã« Promise.all ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã„ã¾ã™

```javaScript: index.js
Promise.all([wait(1000), wait(1500), wait(2000)]).then((nums) => {
  console.log(nums);
});

```

å®Ÿè¡Œçµæœ
![](https://storage.googleapis.com/zenn-user-upload/8ca69d89c23e-20220908.png)
å…¨ã¦ã® wait ãŒçµ‚ã‚ã£ãŸå¾Œã« console.log ã§æˆ»ã‚Šå€¤ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™

ãã—ã¦ã€æˆ»ã‚Šå€¤ã¯é…åˆ—ã§æ¸¡ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™

ã‚‚ã†ä¸€ã¤ä¸¦åˆ—å‡¦ç†ãŒã‚ã‚Šã¾ã™ã€‚
ä¸€ã¤ã§ã‚‚å‡¦ç†ãŒçµ‚ã‚ã‚Œã°æ¬¡ã®å‡¦ç†ã«é€²ã‚€ race ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™

```javaScript: index.js
Promise.race([wait(1000), wait(1500), wait(2000)]).then((nums) => {
  console.log(nums + 1);
});
```

å®Ÿè¡Œçµæœ
![](https://storage.googleapis.com/zenn-user-upload/ac52db879b83-20220908.png)

å‡„ãç°¡å˜ã«éåŒæœŸå‡¦ç†ãŒå®Ÿç¾ã§ãã¾ã™ã­ï¼

ã€Œã§ã‚‚ã•ãƒ¼ã€ã‚‚ã†ã¡ã‚‡ã£ã¨ç›´æ„Ÿçš„ã«æ›¸ã‘ãªã„ï¼Ÿãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ãƒ ã‚ºããªã„ï¼Ÿã€

ã¨ã„ã†æ–¹ã¯ã€await ã¨ async ã‚’è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†

## await ã¨ async

- await ... Promise ã‚’è¿”ã™ãƒ¡ã‚½ãƒƒãƒ‰ã«ã¤ã‘ã‚‹ã“ã¨ã§ã€éåŒæœŸå‡¦ç†ã‚’è¡Œãˆã‚‹
- async ... await ã‚’æŒã¤ãƒ¡ã‚½ãƒƒãƒ‰ã®é ­ã«ã¤ã‘ã‚‹ã“ã¨ã§ã€éåŒæœŸå‡¦ç†ã§ã‚ã‚‹ã“ã¨ã‚’æ•™ãˆã‚‹

ã“ã‚Œã‚‰ã‚’ä½¿ã†ã¨ã€å…ˆã»ã©ã® wait ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã€then ã‚’ä½¿ã‚ãšã«è¨˜è¿°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™

```javaScript: index.js
const wait = (num) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log(num);
      resolve(num);
    }, 1000);
  });
};

const init = async () => {
  let num = await wait(0);
  num++;
  num = await wait(num);
  num++;
  num = await wait(num);
  num++;

  return num;
};

init();
```

å®Ÿè¡Œçµæœ
![](https://storage.googleapis.com/zenn-user-upload/c6f4989241b2-20220909.png)

ãªã‚‹ã»ã©ã€è¨˜è¿°ã—ãŸé †ç•ªé€šã‚Šã«å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã™ã­ã€‚

ã€Œãã—ãŸã‚‰ã€reject ã‚’ä½¿ã£ã¦ã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚’è¡Œã†å ´åˆã¯ã©ã†ãªã‚‹ã®ã•ï¼Ÿã€

ãã®å ´åˆã¯ã€try-catch æ–‡ã‚’ä½¿ã£ã¦å®Ÿç¾ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚ˆãè¦‹ã‚‹å½¢ã§ã™ã­ã€‚

```javaScript: index.js
const wait = (num) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log(num);
      if (num === 2) {
        reject(num);
      } else {
        resolve(num);
      }
    }, 1000);
  });
};

const init = async () => {
  let num;
  try {
    num = await wait(0);
    num++;
    num = await wait(num);
    num++;
    num = await wait(num);
    num++;
  } catch (error) {
    console.error(error, "error");
  }

  return num;
};

init();
```

å®Ÿè¡Œçµæœ
![](https://storage.googleapis.com/zenn-user-upload/ed03072562f5-20220909.png)

ã¡ãªã¿ã«æˆ»ã‚Šå€¤ã¯ Promise ã§ãƒ©ãƒƒãƒ—ã•ã‚ŒãŸã‚‚ã®ã«ãªã‚‹ã®ã§æ³¨æ„ã—ã¾ã—ã‚‡ã†
![](https://storage.googleapis.com/zenn-user-upload/e1348ba8b3fd-20220909.png)

ãã®ãŸã‚ã€init ãƒ¡ã‚½ãƒƒãƒ‰ã‚‚ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãã“ã¨ãŒã§ãã¾ã™ã­ã€‚

```javaScript: index.js
init().then((num) => {
  console.log(num, "End");
});
```

## å‚è€ƒ

https://www.udemy.com/course/draft/2611196/learn/lecture/16597766
